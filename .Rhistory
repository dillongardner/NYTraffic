monthlySTL <- stlplus(monthlyData$DailyAverage, t=monthlyData$Date,
n.p=12, s.window=5,
sub.start=3, sub.labels = month.name)
plot(monthlySTL)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=5,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
stlSubtractedData <- select(fullDataWide, Date, total=`2`)
stlSubtractedData$total <- stlSubtractedData$total - stlDaily$data$seasonal
monthlyWide <- stlSubtractedData
day(monthlyWide$Date) <- 1
monthlyWide <- monthlyWide %>%
group_by(Date) %>%
summarise_each(funs(mean(., na.rm=T)))
stlMonthly <- stlplus(monthlyWide$total, t=monthlyWide$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
plot(stlMonthly)
plot_cycle(stlMonthly)
plot_seasonal(stlMonthly)
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
plot(stlDaily)
plot_seasonal(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=5,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=5,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=3,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=5,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
plot_cycle(stlDaily)
plot_seasonal(stlDaily)
plot(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window="periodic",
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=5,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
stlDaily <- stlplus(fullDataWide$`2`,t=fullDataWide$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
jfkManhattan <- select(fullDataWide, Date, Total=`2`/1000)
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=35,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
head(jfkManhattan)
myData <- read_feather("NYTrafficData.feather")
myData <- myData[!duplicated(myData),]
# Convert Date column from character to date object
myData$Date <-  lubridate::mdy(myData$Date)
# Some dates have multiple entries for each id.
# Looks like this happens with one having cash reported as 0
# We'll just take the highest value for each date
myData <- myData %>%
mutate(total_count=`cash-count` + `etc-count`) %>%
group_by(Date, id) %>%
arrange(desc(total_count)) %>%
slice(1L) %>%
ungroup()
wideData <- myData %>%
select(Date, id, total_count) %>%
spread(id, total_count)
fullDateRange <- data_frame(Date=seq(wideData$Date[1],
tail(wideData$Date, 1),
by="1 day"))
fullDataWide <- left_join(fullDateRange, wideData, by="Date")
fullDataLong <- gather(fullDataWide, "id", "total_count", -Date)
jfkManhattan <- select(fullDataWide, Date, Total=`2`)
jfkManhattan$Total <- jfkManhattan$Total / 1000
head(jfkManhattan)
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily)
?plot.stlplus
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)")
colors()
?colors
ggplot(jfkManhattan) +
geom_line(aes(x=Date, y=Total), color="steelblue") +
labs(title="JFK Bridge - Manhattan Plaza",
y="Total Vehicles (thous.)",
x="Date") +
ylim(0,125)
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(
y=list(
at=seq(-60,0,60, 120))
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(
y=list(
at=seq(-60,0,60, 120)))
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(
y=list(
at=seq(-60,0,60, 120)))
)
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(
y=list(
at=seq(-60,0,60, 120))))
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(y=list(at=seq(-60,0,60)))
)
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(y=list(at=c(-60,0,60, 120)))
)
plot(monthlySTL, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(y=list(at=c(-60,0,60, 120)))
))
plot(monthlySTL, xlab="Date", ylab="Daily Vehicles (thous.)",
scales=list(y=list(at=c(-60,0,60, 120)))
)
plot(monthlySTL, xlab="Date", ylab="Daily Vehicles (thous.)")
library(dplyr)
monthlyData <- jfkManhattan
day(monthlyData$Date) <- 1
monthlyData <- monthlyData %>%
group_by(Date) %>%
summarise_each(funs(mean(., na.rm=T))) %>%
select(Date, DailyAverage=Total)
library(stlplus)
monthlySTL <- stlplus(monthlyData$DailyAverage, t=monthlyData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
plot(monthlySTL, xlab="Date", ylab="Mean Daily Vehicles (thous.)",
scales=list(y=list(at=c(-60,0,60, 120)))
)
plot(monthlySTL, xlab="Date", ylab="Mean Daily Vehicles (thous.)")
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)")
plot(monthlySTL, xlab="Date", ylab="Mean Daily Vehicles (thous.)")
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)")
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=25,
sub.labels=c("Sun", "Mon", "Tues",
"Wed", "Thur", "Fri", "Sat"))
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)")
stlSubtractedData <- jfkManhattan
normalizedData <- jfkManhattan
normalizedData$Total <- normalizedData$Total - stlDaily$data$seasonal
day(normalizedData$Date) <- 1
normalizedData <- normalizedData %>%
group_by(Date) %>%
summarise_each(funs(mean(., na.rm=T)))
head(normalizedData)
stlNormalizedMonthly <- stlplus(normalizedData$total, t=normalizedData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
normalizedData
stlNormalizedMonthly <- stlplus(normalizedData$Total, t=normalizedData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
sum(abs(stlNormalizedMonthly$data$remainder))
sum(abs(stlMonthly$data$remainder))
stlNormalizedMonthly$data
stlDaily$data
head(stlDaily$data)
head(stlDaily$data, 10)
head(stlMonthly$data, 10)
head(stlNormalizedMonthly$data, 10)
monthlyData <- jfkManhattan
day(monthlyData$Date) <- 1
monthlyData <- monthlyData %>%
group_by(Date) %>%
summarise_each(funs(mean(., na.rm=T))) %>%
select(Date, DailyAverage=Total)
library(stlplus)
monthlySTL <- stlplus(monthlyData$DailyAverage, t=monthlyData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
plot(monthlySTL, xlab="Date", ylab="Mean Daily Vehicles (thous.)")
head(stlMonthly$data, 10)
stlMonthly <- stlplus(monthlyData$DailyAverage, t=monthlyData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
stlMonthly <- stlplus(monthlyData$DailyAverage, t=monthlyData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = month.name)
plot(stlMonthly, xlab="Date", ylab="Mean Daily Vehicles (thous.)")
head(stlMonthly)
head(stlMonthly$data)
head(stlDaily$data, 10)
head(stlDaily$data %>% filter(sub.labels=="Sun"), 10)
head(stlDaily$data %>% filter(sub.labels=="Sun"))
stlDaily$data %>% filter(sub.labels=="Sun")
plot_seasonal(stlMonthly)
plot_seasonal(stlDaily)
plot_cycle(stlDaily)
plot_cycle(stlMontly)
plot_cycle(stlMonthly)
plot_cycle(stlNormalizedMonthly)
plot_cycle(stlDaily)
plot_cycle(stlDaily, ylim=c(-16, 16))
p2 <- plot_cycle(stlDaily, ylim=c(-17, 17))
plot_cycle(stlDaily, ylim=c(-17, 17))
p1 <- plot_cycle(stlNormalizedMonthly, ylim=c(-17, 17))
plot_cycle(stlNormalizedMonthly, ylim=c(-17, 17))
grid.arrange(p1,p2, ncol=2)
library(gridExtra)
p1 <- plot_cycle(stlNormalizedMonthly, ylim=c(-17, 17))
p2 <- plot_cycle(stlDaily, ylim=c(-17, 17))
grid.arrange(p1,p2, ncol=2)
grid.arrange(p1,p2, nrow=2)
month.name
jfkManhattan$Date[1]
wday(jfkManhattan$Date[1])
wday(jfkManhattan$Date[1],label = T)
head(stlNormalizedMonthly$data, 12)
head(stlDaily$data, 7)
stlDaily$data[400:407,]
15/90
18/90
tail(stlNormalizedMonthly$data)
head(stlNormalizedMonthly$data)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, color="steelblue")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue")
warnings()
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue")
par()
?plot
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l", bty="n")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",
yaxt="n", ylim=c(0,120), ylab="", axes=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",
xaxt="n", ylim=c(0,120), axes=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty=n)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
xaxt="n")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n")
?axis
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n")
axis(side = 2,at=c(0,50,100))
axis(side = 2,at=c(0,50,100),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n")
axis(side = 2,at=c(0,50,100),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
axt="n")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n")
axis(side = 2,at=c(20 40 60 80),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 2,at=seq(2012, 2016)),tick=F)
axis(side = 1,at=seq(2012, 2016)),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(2012, 2016),tick=F)
seq(2012, 2016)
as.Date("2012/1/1")
?seq
seq(as.Date("2012/1/1"), as.Date("2016/1/1"))
seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza",
xlab="Date",
ylab="Total Vehicles (thous.)")
?plot
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)")
axis(side = 2,at=c(20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)")
axis(side = 2,at=c(0, 20, 40, 60, 80),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)")
axis(side = 2,at=c(0, 20, 40, 60, 80, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 20, 40, 60, 80, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/1/1"), as.Date("2016/1/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = seq(2012, 2016, 1),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/",seq(2012, 2016, 1),tick=F))
title("JFK Bridge - Manhattan Plaza")
paste0("6/",seq(2012, 2016, 1)
)
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6-",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,120))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("Jun ",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 120),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
#labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
labels = paste0("",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
#labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
labels = paste0("",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
library(feather)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stlplus)
library(lubridate)
myData <- read_feather("NYTrafficData.feather")
myData <- myData[!duplicated(myData),]
# Convert Date column from character to date object
myData$Date <-  lubridate::mdy(myData$Date)
# Some dates have multiple entries for each id.
# Looks like this happens with one having cash reported as 0
# We'll just take the highest value for each date
myData <- myData %>%
mutate(total_count=`cash-count` + `etc-count`) %>%
group_by(Date, id) %>%
arrange(desc(total_count)) %>%
slice(1L) %>%
ungroup()
wideData <- myData %>%
select(Date, id, total_count) %>%
spread(id, total_count)
fullDateRange <- data_frame(Date=seq(wideData$Date[1],
tail(wideData$Date, 1),
by="1 day"))
fullDataWide <- left_join(fullDateRange, wideData, by="Date")
fullDataLong <- gather(fullDataWide, "id", "total_count", -Date)
jfkManhattan <- select(fullDataWide, Date, Total=`2`)
jfkManhattan$Total <- jfkManhattan$Total / 1000
plot(x=jfkManhattan$Date, y=jfkManhattan$Total, col="steelblue", type="l",bty="n",
yaxt="n", xaxt="n",
xlab="Date", ylab="Total Vehicles (thous.)",
ylim = c(0,130))
axis(side = 2,at=c(0, 50, 100),tick=F)
axis(side = 1,at=seq(as.Date("2012/6/1"), as.Date("2016/6/1"), length=5),
labels = paste0("6/1/",seq(2012, 2016, 1)),tick=F)
#labels = paste0("",seq(2012, 2016, 1)),tick=F)
title("JFK Bridge - Manhattan Plaza")
weekDays <- c("Sun", "Mon", "Tues","Wed", "Thur", "Fri", "Sat")
stlDaily <- stlplus(jfkManhattan$Total,t=jfkManhattan$Date,
n.p=7, s.window=25,
sub.labels=weekDays, sub.start=1)
plot(stlDaily, xlab="Date", ylab="Daily Vehicles (thous.)")
normalizedData <- jfkManhattan
normalizedData$Total <- normalizedData$Total - stlDaily$data$seasonal
day(normalizedData$Date) <- 1
normalizedData <- normalizedData %>%
group_by(Date) %>%
summarise_each(funs(mean(., na.rm=T)))
stlNormalizedMonthly <- stlplus(normalizedData$Total, t=normalizedData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = monthNames)
monthNames <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun",
"Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
stlNormalizedMonthly <- stlplus(normalizedData$Total, t=normalizedData$Date,
n.p=12, s.window="periodic",
sub.start=3, sub.labels = monthNames)
plot(stlNormalizedMonthly, xlab="Date", ylab="Daily Vehicles (thous.)")
